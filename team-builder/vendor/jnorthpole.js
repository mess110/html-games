// Generated by CoffeeScript 1.10.0
window.jNorthPole = {
  BASE_URL: 'https://json.northpole.ro/',
  help: "NorthPole JS wrapper example usage:\n\nresponseHandler = function (data) {\n  console.log(data);\n};\n\njNorthPole.getStorage(json, responseHandler);\n\nsocket = jNorthPole.getNewRealtimeSocket(responseHandler)\njNorthPole.subscribe(socket, 'foo')\njNorthPole.publish(socket, 'foo', { message: 'hello' })",
  genericRequest: function(jsonObj, method, endPoint, responseHandler, errorHandler) {
    var r;
    if (errorHandler == null) {
      errorHandler = responseHandler;
    }
    if (responseHandler == null) {
      throw 'responseHandler function missing';
    }
    r = new XMLHttpRequest;
    r.open(method, "" + this.BASE_URL + endPoint + ".json", true);
    r.onreadystatechange = function() {
      if (r.readyState !== 4) {
        return;
      }
      if (r.status === 200) {
        responseHandler(JSON.parse(r.responseText), r.status);
      } else {
        errorHandler(JSON.parse(r.responseText), r.status);
      }
    };
    r.send(JSON.stringify(jsonObj));
  },
  createUser: function(api_key, secret, success, failure) {
    var jsonObj;
    jsonObj = {
      'api_key': api_key,
      'secret': secret
    };
    this.genericRequest(jsonObj, 'POST', 'user', success, failure);
  },
  getUser: function(jsonObj, responseHandler, errorHandler) {
    this.genericRequest(jsonObj, 'SEARCH', 'user', responseHandler, errorHandler);
  },
  createStorage: function(jsonObj, responseHandler, errorHandler) {
    this.genericRequest(jsonObj, 'POST', 'storage', responseHandler, errorHandler);
  },
  getStorage: function(jsonObj, responseHandler, errorHandler) {
    this.genericRequest(jsonObj, 'SEARCH', 'storage', responseHandler, errorHandler);
  },
  putStorage: function(jsonObj, responseHandler, errorHandler) {
    this.genericRequest(jsonObj, 'PUT', 'storage', responseHandler, errorHandler);
  },
  deleteStorage: function(jsonObj, responseHandler, errorHandler) {
    this.genericRequest(jsonObj, 'DELETE', 'storage', responseHandler, errorHandler);
  },
  getNewRealtimeSocket: function(responseHandler, errorHandler) {
    var socket, socketUrl;
    if (errorHandler == null) {
      errorHandler = responseHandler;
    }
    socketUrl = this.BASE_URL.replace('http', 'ws');
    socket = new WebSocket(socketUrl + "realtime");
    socket.onmessage = responseHandler;
    socket.onclose = errorHandler;
    return socket;
  },
  subscribe: function(socket, channel_name) {
    return socket.send(JSON.stringify({
      type: 'subscribe',
      channel_name: channel_name
    }));
  },
  unsubscribe: function(socket, channel_name) {
    return socket.send(JSON.stringify({
      type: 'unsubscribe',
      channel_name: channel_name
    }));
  },
  publish: function(socket, channel_name, json) {
    return socket.send(JSON.stringify({
      type: 'publish',
      channel_name: channel_name,
      content: json
    }));
  }
};
